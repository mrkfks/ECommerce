@model CampaignCreateVm

@{
    ViewData["Title"] = "Yeni Kampanya";
}

<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-md-8">
            <h2>Yeni Kampanya Oluştur</h2>
            <p class="text-muted">Yeni bir kampanya tanımı oluşturun ve banner fotoğrafı ekleyin</p>
        </div>
    </div>

    <div class="row">
        <div class="col-md-8">
            <div class="card shadow-sm">
                <div class="card-body">
                    <form asp-action="Create" method="post" enctype="multipart/form-data">
                        <div class="mb-3">
                            <label asp-for="Name" class="form-label">Kampanya Adı *</label>
                            <input asp-for="Name" class="form-control" placeholder="Örn: Güz İndirimi" required>
                            <span asp-validation-for="Name" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label asp-for="Description" class="form-label">Açıklama</label>
                            <textarea asp-for="Description" class="form-control" rows="3" placeholder="Kampanya hakkında bilgi girin"></textarea>
                            <span asp-validation-for="Description" class="text-danger"></span>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label asp-for="DiscountPercent" class="form-label">İndirim Yüzdesi (%) *</label>
                                    <div class="input-group">
                                        <input asp-for="DiscountPercent" type="number" step="0.01" min="0" max="100" class="form-control" placeholder="20" required>
                                        <span class="input-group-text">%</span>
                                    </div>
                                    <span asp-validation-for="DiscountPercent" class="text-danger"></span>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Kampanya Durumu</label>
                                    <div class="form-control-plaintext">
                                        <span class="badge bg-secondary">Yaklaşan</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label asp-for="StartDate" class="form-label">Başlangıç Tarihi *</label>
                                    <input asp-for="StartDate" type="datetime-local" class="form-control" required>
                                    <span asp-validation-for="StartDate" class="text-danger"></span>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label asp-for="EndDate" class="form-label">Bitiş Tarihi *</label>
                                    <input asp-for="EndDate" type="datetime-local" class="form-control" required>
                                    <span asp-validation-for="EndDate" class="text-danger"></span>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label asp-for="BannerImageUrl" class="form-label">Banner Fotoğrafı</label>
                            <div id="dropZone" class="border-2 border-dashed border-secondary rounded p-4 text-center cursor-pointer mb-2" style="cursor: pointer; transition: all 0.3s;">
                                <i class="fas fa-cloud-upload-alt fa-3x text-secondary mb-2"></i>
                                <p class="mb-0">Fotoğraf sürükleyin veya tıklayın</p>
                                <small class="text-muted">JPG, PNG, WebP (Max: 5MB)</small>
                            </div>
                            <input type="file" id="bannerFile" name="bannerFile" class="form-control" accept="image/*" style="display: none;">
                            <div id="previewContainer" class="mt-3"></div>
                            <span asp-validation-for="BannerImageUrl" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label class="form-label d-block">Ön İzleme</label>
                            <div id="campaignPreview" class="card bg-light p-3" style="max-width: 400px;">
                                <div id="previewImage" class="bg-white rounded mb-2" style="height: 180px; display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-image fa-3x text-muted"></i>
                                </div>
                                <div>
                                    <h6 id="previewName" class="mb-1">Kampanya Adı</h6>
                                    <p id="previewDesc" class="mb-2 text-muted small">Açıklama</p>
                                    <div>
                                        <span class="badge bg-warning text-dark" id="previewDiscount">%20</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Kampanyayı Oluştur
                            </button>
                            <a href="@Url.Action("Index")" class="btn btn-secondary">
                                <i class="fas fa-times"></i> İptal
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card shadow-sm bg-light">
                <div class="card-body">
                    <h5 class="card-title">
                        <i class="fas fa-info-circle"></i> İpuçları
                    </h5>
                    <ul class="small">
                        <li>Kampanya adını açıklayıcı tutun</li>
                        <li>İndirim yüzdesini doğru girin (0-100)</li>
                        <li>Başlangıç tarihi bitiş tarihinden olur</li>
                        <li>Banner fotoğrafını 800x400 boyutunda kullanın</li>
                        <li>Kampanya oluşturduktan sonra ürünler ekleyebilirsiniz</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        // File upload handling
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('bannerFile');
        const previewContainer = document.getElementById('previewContainer');

        // Click to upload
        dropZone.addEventListener('click', () => fileInput.click());

        // Drag and drop
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('bg-primary', 'bg-opacity-10');
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('bg-primary', 'bg-opacity-10');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('bg-primary', 'bg-opacity-10');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                // Set the file to the input element
                const dataTransfer = new DataTransfer();
                dataTransfer.items.add(files[0]);
                fileInput.files = dataTransfer.files;
                handleFileSelection();
            }
        });

        fileInput.addEventListener('change', handleFileSelection);

        function handleFileSelection() {
            const file = fileInput.files[0];
            if (!file) return;

            if (!file.type.startsWith('image/')) {
                alert('Lütfen bir resim dosyası seçin');
                fileInput.value = '';
                return;
            }

            if (file.size > 5 * 1024 * 1024) {
                alert('Dosya boyutu 5MB\'dan küçük olmalıdır');
                fileInput.value = '';
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                const dataUrl = e.target.result;

                // Show preview
                previewContainer.innerHTML = `
                    <div class="position-relative">
                        <img src="${dataUrl}" alt="Banner Preview" class="img-fluid rounded" style="max-width: 100%;">
                        <button type="button" class="btn btn-sm btn-danger position-absolute top-0 end-0 m-2" onclick="clearPreview()">
                            <i class="fas fa-trash"></i> Temizle
                        </button>
                    </div>
                `;

                // Update preview
                document.getElementById('previewImage').innerHTML = `<img src="${dataUrl}" alt="Banner" style="width: 100%; height: 100%; object-fit: cover; border-radius: 0.25rem;">`;
            };
            reader.readAsDataURL(file);
        }

        function clearPreview() {
            fileInput.value = '';
            previewContainer.innerHTML = '';
            document.getElementById('previewImage').innerHTML = '<i class="fas fa-image fa-3x text-muted"></i>';
        }

        // Live preview updates
        document.getElementById('Name').addEventListener('input', (e) => {
            document.getElementById('previewName').textContent = e.target.value || 'Kampanya Adı';
        });

        document.getElementById('Description').addEventListener('input', (e) => {
            document.getElementById('previewDesc').textContent = e.target.value || 'Açıklama';
        });

        document.getElementById('DiscountPercent').addEventListener('input', (e) => {
            document.getElementById('previewDiscount').textContent = `%${e.target.value || '0'}`;
        });
    </script>
}
